{"version":3,"file":"prioritynav.js","sources":["../src/o-priority-nav.js"],"sourcesContent":["/**\n * --------------------------------------------------------------------------\n * Boosted (v4.5.3): o-priority-nav.js\n * Licensed under MIT (https://github.com/Orange-OpenSource/Orange-Boosted-Bootstrap/blob/master/LICENSE)\n * --------------------------------------------------------------------------\n */\n\nimport $ from 'jquery'\n\n/**\n * ------------------------------------------------------------------------\n * Constants\n * ------------------------------------------------------------------------\n */\n\nconst NAME = 'prioritynav'\nconst VERSION = '4.5.3'\nconst DATA_KEY = 'bs.prioritynav'\nconst JQUERY_NO_CONFLICT = $.fn[NAME]\nconst RESIZE_DURATION = 500\nconst TAB_KEYCODE = 9\n\nconst EVENT_RESIZE = 'resize'\n\nconst CLASS_NAME_HIDE = 'sr-only'\nconst CLASS_NAME_RESIZING = 'resizing overflow-hidden'\n\nconst SELECTOR_NAV_ELEMENTS = 'li:not(\\'.overflow-nav\\')'\nconst SELECTOR_FIRST_ELEMENT = 'li:first'\n\nconst MenuLabelDefault = 'More'\n\nfunction MenuTemplate(MenuLabel) {\n  return `\n  <li class=\"overflow-nav nav-item dropdown d-none\">\n      <a href=\"#\" class=\"dropdown-toggle nav-link\" data-toggle=\"dropdown\" role=\"button\" aria-haspopup=\"true\">${MenuLabel}</a>\n      <ul class=\"overflow-nav-list dropdown-menu dropdown-menu-right\"></ul>\n  </li>\n`\n}\n\n/**\n * ------------------------------------------------------------------------\n * Class Definition\n * ------------------------------------------------------------------------\n */\n\nclass PriorityNav {\n  constructor(element, config) {\n    this._element = element\n    this._config = config\n\n    if ($(element).is('ul')) {\n      this._$menu = $(element)\n    } else {\n      this._$menu = $(element).find('ul').first()\n    }\n\n    this._initMenu()\n    this._$allNavElements = this._$menu.find(SELECTOR_NAV_ELEMENTS)\n    this._bindUIActions()\n    this._setupMenu()\n  }\n\n  // getters\n\n  static get VERSION() {\n    return VERSION\n  }\n\n  // public\n\n  // private\n\n  _initMenu() {\n    let MenuLabel = this._config\n\n    if (typeof MenuLabel === 'undefined') {\n      MenuLabel = MenuLabelDefault\n    }\n\n    // add menu template\n    this._$menu.append(MenuTemplate(MenuLabel))\n  }\n\n  _setupMenu() {\n    const $allNavElements = this._$allNavElements\n\n    // Checking top position of first item (sometimes changes)\n    const firstPos = this._$menu.find(SELECTOR_FIRST_ELEMENT).position()\n\n    // Empty collection in which to put menu items to move\n    let $wrappedElements = $()\n\n    // Used to snag the previous menu item in addition to ones that have wrapped\n    let first = true\n\n    // Loop through all the nav items...\n    this._$allNavElements.each(function (i) {\n      const $elm = $(this)\n\n      // ...in which to find wrapped elements\n      const pos = $elm.position()\n\n      if (pos.top !== firstPos.top) {\n        // If element is wrapped, add it to set\n        $wrappedElements = $wrappedElements.add($elm)\n\n        // Add the previous one too, if first\n        if (first) {\n          $wrappedElements = $wrappedElements.add($allNavElements.eq(i - 1))\n          first = false\n        }\n      }\n    })\n\n    if ($wrappedElements.length) {\n      // Clone set before altering\n      const newSet = $wrappedElements.clone()\n\n      // Hide ones that we're moving\n      $wrappedElements.addClass(CLASS_NAME_HIDE)\n      $wrappedElements.find('.nav-link').attr('tabindex', -1)\n\n      // Add wrapped elements to dropdown\n      this._$menu.find('.overflow-nav-list').append(newSet)\n\n      // Show new menu\n      this._$menu.find('.overflow-nav').removeClass('d-none').addClass('d-inline-block')\n\n      // Make overflow visible again so dropdown can be seen.\n      this._$menu.find('.o-nav-local').css('overflow', 'visible')\n\n      // Check if menu doesn't overflow after process\n      if (this._$menu.find('.overflow-nav').position().top !== firstPos.top) {\n        const $item = $(this._element).find(`.${CLASS_NAME_HIDE}`).first().prev()\n        const $itemDuplicate = $item.clone()\n\n        $item.addClass(CLASS_NAME_HIDE)\n        $item.find('.nav-link').attr('tabindex', -1)\n\n        this._$menu.find('.overflow-nav-list').prepend($itemDuplicate)\n      }\n    }\n\n    // hide menu from AT\n    this._$menu.find('.overflow-nav').attr('aria-hidden', true)\n  }\n\n  _tearDown() {\n    this._$menu.find('.overflow-nav-list').empty()\n    this._$menu.find('.overflow-nav').removeClass('d-inline-block').addClass('d-none')\n    this._$allNavElements.removeClass(CLASS_NAME_HIDE)\n    this._$allNavElements.find('.nav-link').attr('tabindex', 0)\n  }\n\n  _bindUIActions() {\n    $(window).on(EVENT_RESIZE, () => {\n      this._$menu.addClass(CLASS_NAME_RESIZING)\n\n      setTimeout(() => {\n        this._tearDown()\n        this._setupMenu()\n        this._$menu.removeClass(CLASS_NAME_RESIZING)\n      }, RESIZE_DURATION)\n    })\n\n    this._$menu.find('.overflow-nav .dropdown-toggle').on('keyup', e => {\n      if (e.which === TAB_KEYCODE) {\n        $(e.target).dropdown('toggle')\n      }\n    })\n  }\n\n  // static\n\n  static _jQueryInterface(config) {\n    return this.each(function () {\n      let data = $(this).data(DATA_KEY)\n\n      if (!data) {\n        data = new PriorityNav(this, config)\n        $(this).data(DATA_KEY, data)\n      }\n\n      if (typeof config !== 'undefined' && config) {\n        if (typeof config !== 'string') {\n          throw new TypeError('Priority nav label type must be string')\n        }\n      }\n    })\n  }\n}\n\n/**\n * ------------------------------------------------------------------------\n * jQuery\n * ------------------------------------------------------------------------\n */\n\n$.fn[NAME] = PriorityNav._jQueryInterface\n$.fn[NAME].Constructor = PriorityNav\n$.fn[NAME].noConflict = () => {\n  $.fn[NAME] = JQUERY_NO_CONFLICT\n  return PriorityNav._jQueryInterface\n}\n\nexport default PriorityNav\n"],"names":["NAME","VERSION","DATA_KEY","JQUERY_NO_CONFLICT","$","fn","RESIZE_DURATION","TAB_KEYCODE","EVENT_RESIZE","CLASS_NAME_HIDE","CLASS_NAME_RESIZING","SELECTOR_NAV_ELEMENTS","SELECTOR_FIRST_ELEMENT","MenuLabelDefault","MenuTemplate","MenuLabel","PriorityNav","element","config","_element","_config","is","_$menu","find","first","_initMenu","_$allNavElements","_bindUIActions","_setupMenu","append","$allNavElements","firstPos","position","$wrappedElements","each","i","$elm","pos","top","add","eq","length","newSet","clone","addClass","attr","removeClass","css","$item","prev","$itemDuplicate","prepend","_tearDown","empty","window","on","setTimeout","e","which","target","dropdown","_jQueryInterface","data","TypeError","Constructor","noConflict"],"mappings":"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"}